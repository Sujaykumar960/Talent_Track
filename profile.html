<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Profile - TalentTrack</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="logo">TalentTrack</div>
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a id="logout2" href="#">Logout</a>
    </nav>
  </header>

  <main class="container">
    <div class="card">
      <h2 id="profileTitle">My Profile</h2>
      <form id="profileForm">
        <label>Full name</label>
        <input type="text" id="pname" />
        <label>Sport</label>
        <input type="text" id="psport" />
        <label>Age</label>
        <input type="number" id="page" />
        <label>Location</label>
        <input type="text" id="plocation" />
        <label>Short Bio</label>
        <textarea id="pbio" rows="3"></textarea>

        <h3>Uploaded Videos</h3>
        <div id="videosList"></div>

        <button type="submit" class="btn">Save Profile</button>
      </form>
    </div>
  </main>

  <script src="app.js"></script>
  <script>
    const currentUser = getCurrentUser();
    if (!currentUser) location.href = 'signin.html';
    document.getElementById('logout2').addEventListener('click', function(e){
      e.preventDefault();
      signOut();
      location.href = 'signin.html';
    });

    // if we came from scout viewing, load that profile else current
    const viewEmail = localStorage.getItem('viewProfileEmail');
    const viewUser = viewEmail ? getUserByEmail(viewEmail) : null;
    const userToShow = viewUser || currentUser;

    document.getElementById('profileTitle').textContent = viewUser ? `${userToShow.name} — Profile` : 'My Profile';
    // populate form (editable only if own profile)
    document.getElementById('pname').value = userToShow.name || '';
    document.getElementById('psport').value = userToShow.sport || '';
    document.getElementById('page').value = userToShow.age || '';
    document.getElementById('plocation').value = userToShow.location || '';
    document.getElementById('pbio').value = (userToShow.profile&&userToShow.profile.bio) || '';

    // show videos
    function renderVideos(){
      const box = document.getElementById('videosList');
      box.innerHTML = '';
      const vids = userToShow.videos || [];
      if (vids.length===0) box.innerHTML = '<p>No videos uploaded.</p>';
      vids.forEach((v, i)=>{
        const div = document.createElement('div');
        div.className = 'videoItem';
        div.innerHTML = `<video src="${v.data}" controls style="max-width:100%;"></video>
                         <p>${escapeHtml(v.caption || '')} • ${new Date(v.uploadedAt||'').toLocaleString()}</p>`;
        box.appendChild(div);
      });
    }
    renderVideos();

    // only allow editing if it's your own profile
    if (userToShow.email !== currentUser.email) {
      // disable form
      document.querySelectorAll('#profileForm input, #profileForm textarea, #profileForm button').forEach(el=>el.disabled=true);
    } else {
      document.getElementById('profileForm').addEventListener('submit', function(e){
        e.preventDefault();
        currentUser.name = document.getElementById('pname').value.trim();
        currentUser.sport = document.getElementById('psport').value.trim();
        currentUser.age = document.getElementById('page').value;
        currentUser.location = document.getElementById('plocation').value.trim();
        currentUser.profile = currentUser.profile || {};
        currentUser.profile.bio = document.getElementById('pbio').value.trim();
        saveUser(currentUser);
        alert('Profile saved.');
        location.href='dashboard.html';
      });
    }
  </script>
</body>
</html>
